#include <ESP8266WiFi.h>
#include <Firebase_ESP_Client.h>

// -------- WiFi --------
#define WIFI_SSID     "Ibrahim's Galaxy S10+"
#define WIFI_PASSWORD "00008888"

// -------- Firebase --------
#define API_KEY "AIzaSyDMXtzGf6rLLkWFGI4rJ4TH1ZDfEs1jOEA"
#define DATABASE_URL "https://smart-home-automation-sy-5bcd7-default-rtdb.firebaseio.com/"

// -------- Pins (NodeMCU) --------
#define LED_PIN    D5
#define BUZZER_PIN D6

FirebaseData fbdo;
FirebaseAuth auth;
FirebaseConfig config;

void setup() {
  Serial.begin(9600);

  pinMode(LED_PIN, OUTPUT);
  pinMode(BUZZER_PIN, OUTPUT);
  digitalWrite(LED_PIN, LOW);
  digitalWrite(BUZZER_PIN, LOW);

  // Connect WiFi
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Connecting to WiFi");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWiFi connected");

  // Firebase setup
  config.api_key = API_KEY;
  config.database_url = DATABASE_URL;

  // üîê Legacy Database Secret (token)
  config.signer.tokens.legacy_token = "6pfAOeanmqccPJGEhpj5Q38o4N3DePeaY7YPkPyx";

  Firebase.begin(&config, &auth);
  Firebase.reconnectWiFi(true);
}

void loop() {
  // Read LED state from Firebase
  if (Firebase.RTDB.getInt(&fbdo, "/ledState")) {
    int ledVal = fbdo.intData();
    digitalWrite(LED_PIN, ledVal ? HIGH : LOW);
    Serial.print("LED: ");
    Serial.println(ledVal);
  } else {
    Serial.print("LED error: ");
    Serial.println(fbdo.errorReason());
  }

  // Read Buzzer state from Firebase
  if (Firebase.RTDB.getInt(&fbdo, "/buzzerState")) {
    int buzzerVal = fbdo.intData();
    digitalWrite(BUZZER_PIN, buzzerVal ? HIGH : LOW);
    Serial.print("Buzzer: ");
    Serial.println(buzzerVal);
  } else {
    Serial.print("Buzzer error: ");
    Serial.println(fbdo.errorReason());
  }

  delay(1000);
}
